# 互联网

互联网络将不同的计算机网络连接起来并允许位于网络中的主机相互之间进行通信。子网络或者子网，指的是因特网的其中一个网络。

互联网的目标是隐藏不同物理网络的细节以便向互联网络中的所有主机呈现一个统一的网络架构。

![](./img/internet.png)

# 互联网协议和层

一个联网协议是定义如何在一个网络上传输信息的一组规则，网络协议一般会组织成一系列的层，每一层都构建于下层之上并提供特性以供上层使用。

协议分层可以使得每一个协议层都对上层隐藏下层的操作和复杂性。

![](./img/protocol.png)

![](./img/layer.png)

## 封装

封装是分层联网协议中的一个重要原则。

封装中的关键概念是低层会将高层向低层传递的信息当成不透明的数据来处理。也就是说，低层不会对高层发送过来的信息进行解释，而只会将这些信息放到低层所使用的包中并在将这个包下传递到低层之前添加自身这一层的信息。

当数据从低层传递到高层时将会进行一个逆向的解包过程。

![](./img/pack.png)

# 数据链路层

数据链路层由设备驱动和到底层物理媒介(如电线，同轴电缆，光纤)的硬件接口(网卡)构成。

数据链路层关注的是在一个网络的物理连接上传输数据。要传输数据，数据链路层需要将网络层传递过来的数据报封装进被称为帧的一个一个单元。除了需要传输数据之外，每个帧都会包含一个头，头中可能包含了目标地址和帧的大小。

这一层可能会进行错误检测、重传以及流量控制。一些数据链路层还可能会将大的网络包分隔成多个帧并在接收者端对这些帧进行重组。

数据链路层比较重要的一个特点是最大传输单元(MTU)，MTU 是该层所能传输的帧大小的上限。

`netstat -i` 可以列出系统中的网络接口，包括 MTU。

# 网络层

网络层关注的是如何将包从源主机发送到目标主机。

这一层的主要任务：

- 将数据分解成足够小的片段以便数据链路层进行传输
- 在因特网上路由数据
- 为传输提供服务

TCP/IP 协议套件中，网络层的主要协议是 IP。IP 协议的主要版本有：

- IPv4，使用 32 位地址来标识子网和主机
- IPv6，使用 128 位地址，从而为主机提供更大的地址范围

## IP 传输数据报

IP 以数据报(包)的形式来传输数据。在两个主机之间发送的每一个数据报都是在网络上独立传输的，它们经过的路径可能会不同。

一个 IP 数据报包含一个头，范围是 20-60 字节，包含了目标主机的地址，包的源地址。

一个 IP 实现可能会给它所支持的数据报的大小设定一个上限，在 IPv4 中这个限制是 576 字节，在 IPv6 中这个限制是 1500 字节。

## IP 是无连接和不可靠的

IP 是一种无连接协议，因为并没有在两个相互连接的主机之间提供一个虚拟电路。

IP 也是一种不可靠协议，它尽最大可能将数据报从发送者传输给接收者，但并不保证到达的顺序会与它们被传输的顺序一致，也不保证包是否重复，甚至不保证包是否到达接受者。

IP 也没有提供错误恢复，头信息错误的包会被静默地丢弃。

## IP 可能会对数据报进行分段

IPv4 数据报的最大大小是 65535 字节。默认情况下，IPv6 允许一个数据报的最大大小为 65575 字节，并且为更大的数据报提供了一个选项。

当一个 IP 数据报的大小大于 MTU 时，IP 会将数据报分段成一个个大小合适在网络上传输的单元，这些分段在达到最终目的地之后会被重组成原始数据报。每个 IP 分段本身就是包含了一个偏移量字段的 IP 数据报，该字段给出了一个该分段在原始数据报中的位置。

# IP 地址























































































